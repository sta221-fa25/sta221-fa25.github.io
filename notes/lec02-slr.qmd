---
title: "Simple linear regression"
author: "Dr. Alexander Fisher"
format: html
---

```{r}
#| echo: false
#| eval: false
weather = 
  read_csv("../data/rdu-weather-history-complete.csv") %>%
    filter(date >= as.Date("2021-09-01")) %>%
    filter(date <= as.Date("2021-09-30")) %>%
  select(date, tmin, tmax)

plot(weather$tmin, weather$tmax)

write_csv(weather, "../data/rdu-weather-history.csv")
```


```{r}
#| label: load-packages
#| code-fold: true
#| code-summary: "View libraries and data sets used in these notes"
#| warning: false
#| messge: false
library(tidyverse)
library(DT)
 
weather = 
  read_csv("https://sta221-fa25.github.io/data/rdu-weather-history.csv") %>%
  arrange(date)
    
```

## Learning objectives

By the end of the day you should be able to explain the following concepts:

1.  covariance
2.  correlation
3.  location and scale invariance
4.  ordinary least squares

## Example

<!-- The `cars` data set (from base R). The variable `speed` is recorded in miles per hour (mph) while stopping distance `dist` is recorded in feet. -->

This data set contains Raleigh Durham International Airport weather data pulled from the NOAA web service between September 01 and September 30, 2021. The data were sourced from [https://catalog.data.gov/](https://catalog.data.gov/dataset/local-weather-archive/resource/70f03146-c910-4baf-a1e3-9cc92bc7d9bb) August 28, 2025.

```{r}
#| echo: false
datatable(weather, rownames = FALSE, options = list(pageLength = 5),
           caption = "The min. and max. daily temperature at RDU international airport in Farenheit")
```


<!-- ```{r} -->
<!-- #| echo: false -->
<!-- datatable(cars, rownames = FALSE, options = list(pageLength = 5), -->
<!--           caption = "The speed of cars and the distances taken to stop. Note that the data were recorded in the 1920s.") -->
<!-- ``` -->

We've recorded 30 observations of two measurements. We are interested in the association between these two measurements.

We'll call the minimum daily temperature measurement "x" and the maximum daily temperature "y".

## Vocabulary

| Variable  | Explanation |
|----|--------------|
|    $y$       | The outcome variable. Also called "response" or "dependent variable". In prediction tasks, this is the variable we are interested in predicting.    |
|  $x$         |  The predictor. Also called "covariate", "feature", or "independent variable".    |


How are $x$ and $y$ associated? 

:::panel-tabset 

## Scatter plot
```{r}
#| echo: false
#| warning: false

weather %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point() +
  labs(title = "Minimum and maxmimum temperature at RDU in September, 2021") +
  theme_bw()
```

## Code
```{r}
#| eval: false

weather %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point() +
  labs(title = "Minimum and maxmimum temperature (F) at RDU in September, 2021") +
  theme_bw()
```

:::

Notice: visualized this way, each of the thirty data points, $(x_i, y_i)$, is an element of two-dimensional space.

- How would you describe the association?


::: callout-note
## Definition: covariance

$cov(x, y) = \frac{1}{n-1}\sum_{i =1}^n (x_i - \bar{x}) (y_i - \bar{y})$ $^*$ 
  
$^*$ Note that we divide by $n-1$ when computing the *sample covariance*

- $\bar{x} = \frac{1}{n} \sum x_i$ (mean of x)
- $\bar{y} = \frac{1}{n} \sum y_i$ (mean of y)
:::

```{r}
x = weather %>%
  select(tmin) %>%
  pull()
y = weather %>%
  select(tmax) %>%
  pull()

cov(x, y)

sum((x - mean(x)) * (y - mean(y))) / (30 - 1)
```

- Should the association be the same if the thermometer recording measurements was consistently off by 2 degrees Farenheit?

```{r}
# compute covariance of true temperature measurement
weather %>%
  mutate(temp_min_true = tmin + 2,
         temp_max_true = tmax + 2) %>%
  summarize(cov(temp_min_true, temp_max_true)) %>%
  pull()
```

Covariance is **location invariant**.

- Will the association stay the same if we recorded temperature in celsius?

```{r}
# compute the covariance between temperature in celsius
weather %>%
  mutate(temp_min_c = (tmin - 32) * 5 / 9,
         temp_max_c = (tmax - 32) * 5 / 9) %>%
  summarize(cov(temp_min_c, temp_max_c)) %>%
  pull()
```

Covariance is **not scale invariant**. That is, covariance does depend on the scale of the measurements.

## Correlation

::: callout-note
## Definition: correlation

$cor(x, y) = \frac{\sum_{i=1}^n (x_i - \bar{x})^2 (y_i - \bar{y})^2}{\left(\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2\right)^{1/2}}$

More concisely, we may write
  
$cor(x, y) = \frac{S_{xy}}{S_{xx}^{1/2} S_{yy}^{1/2}}$
:::

```{r}
# correlation in Farenheit vs Celsi
# compute the covariance between temperature in celsius
weather %>%
  mutate(temp_min_c = (tmin - 32) * 5 / 9,
         temp_max_c = (tmax - 32) * 5 / 9) %>%
  summarize(cor_F = cor(tmin, tmax), 
            cor_C = cor(temp_min_c, temp_max_c))
```

::: panel-tabset
## Exercise

Show $cor(x, y) = cor(ax + b, cy + d)$.
:::

Correlation is **location and scale invariant**!

Additional facts about correlation:

- Correlation is not invariant to monotone transformations of the data

::: callout-note
## Definition: monotone

$g$ is a monotonic function iff $x \leq y$ implies $g(x) \leq g(y)$
:::

::: panel-tabset
## Exercise

Show by example that correlation is not invariant to monotonic transformations.
:::

- Correlation is *not* robust to outliers

:::panel-tabset

## Example 1
```{r}
set.seed(221)
x = c(1:5)
y= x + rnorm(5)
plot(x, y)
cor(x, y)
```

## Example 2
```{r}
x2 = c(x, 0)
y2 = c(y, 20)
plot(x2, y2)
cor(x2, y2)
```
:::

- Correlation is bounded between -1 and 1.

:::panel-tabset
## Exercise

Show that $|cor(x, y)| \leq 1$
:::

- correlation is a measure of *linear* association

::: panel-tabset

## Example 1
```{r}
x = -10:10
y = x^2
plot(x, y)
cor(x, y) 
```

## Example 2

```{r}
x = -10:10
y = x
plot(x, y)
cor(x, y)
```

:::

Since correlation is related to a linear relationship between the data, this implies 

$$
y_i = \beta_0 + \beta_1 x_i + \epsilon_i
$$

Check out the interactive regression web app here:
  
  [https://seeing-theory.brown.edu/regression-analysis/index.html#section1](https://seeing-theory.brown.edu/regression-analysis/index.html#section1)