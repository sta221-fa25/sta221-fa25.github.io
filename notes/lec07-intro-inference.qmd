---
title: "Introduction to inference"
author: "Dr. Alexander Fisher"
format: html
---

\newcommand{\by}{\boldsymbol{y}}
\newcommand{\hby}{\hat{\boldsymbol{y}}}
\newcommand{\bone}{\boldsymbol{1}}
\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\bX}{\boldsymbol{X}}
\newcommand{\be}{\boldsymbol{\varepsilon}}
\newcommand{\hbe}{\hat{\be}}

```{r}
#| label: load-packages
#| code-fold: true
#| code-summary: "View libraries and data sets used in these notes"
#| warning: false
#| message: false
library(tidyverse)
library(tidymodels)
library(DT)
library(latex2exp)
library(patchwork)

pokemon <- read_csv("~/Downloads/pokemon_data.csv") # complete, population data
```

## The data 

As of 2025, there are 1025 pokemon in existence.

In all statistical inference tasks, we only have a *sample* from the population. Let's consider a random sample of the pokemon data, given below:

```{r}
#| echo: false
#| eval: false
for(i in 1:1000) {
  set.seed(i)
  sample = pokemon %>% 
  slice_sample(n = 15) %>%
    filter(name == "Pikachu") %>%
    nrow()
  if(sample != 0) {
    print(i)
  }
}
```


```{r}
set.seed(48) 
pokemon_sample <- pokemon |>
  slice_sample(n = 15) |>
  select(dexnum, name, height_m, weight_kg) |>
  arrange(dexnum)
  

datatable(pokemon_sample, rownames = FALSE, options = list(pageLength = 5),
           caption = "sample of 15 pokemon")
```

Let's investigate the question: do taller pokemon weigh more? 

::: panel-tabset
## plot

```{r}
#| echo: false
#| warning: false
pokemon_sample |>
  ggplot(aes(x = height_m, y = weight_kg)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE, color = 'steelblue') +
  theme_bw() +
  labs(title = "Pokemon weight vs height", x = "height (m)", y = "weight (kg)")
```

## linear model

```{r}
lm(weight_kg ~ height_m, data = pokemon_sample) |>
  tidy()
```

## plot code 

```{r}
#| eval: false
pokemon_sample |>
  ggplot(aes(x = height_m, y = weight_kg)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE, color = 'steelblue') +
  theme_bw() +
  labs(title = "Pokemon weight vs height", x = "height (m)", y = "weight (kg)")
```

:::


## Question

How can we tell if our estimates $\hat{\beta}$ are any good?

:::panel-tabset

## repeated sampling

```{r}
pokemon_hw = pokemon |>
  select(height_m, weight_kg)

BETA_HAT <- NULL
for(i in 1:1000) {
  fit <- pokemon_hw |>
    slice_sample(n = 15) |> 
    lm(height_m ~ weight_kg, data = _) 
  BETA_HAT <- rbind(BETA_HAT, fit$coefficients)
}

BETA_HAT <- data.frame(BETA_HAT)
colnames(BETA_HAT) <- c("beta0", "beta1")

glimpse(BETA_HAT)
```

## plots

```{r}
#| warning: false
#| echo: false
set.seed(221)

p1 <- BETA_HAT |>
  ggplot(aes(x = beta0, y = beta1)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon") +
  xlim(c(0, 2)) +
  ylim(c(0, 0.025)) +
  theme_bw() +
  labs(title = "Joint distribution", x = TeX("$\\hat{\\beta}_0$"),
       y = TeX("$\\hat{\\beta}_1$"), fill = "density")

p2 <- BETA_HAT |> 
  ggplot(aes(x = beta0)) +
  geom_density(aes(y = ..density..)) +
  theme_bw() +
  labs(title = "Marginal densities", 
       x = TeX("$\\hat{\\beta}_0$"))

p3 <- BETA_HAT |> 
  ggplot(aes(x = beta1)) +
  geom_density(aes(y = ..density..)) +
  theme_bw() +
  labs(x = TeX("$\\hat{\\beta}_1$"))

(p1) / (p2 + p3) + plot_annotation(title = "Sampling variability in OLS estimates")
```
## population-level annotation

```{r}
popn_model <- lm(height_m ~ weight_kg, data = pokemon)
popn_model$coefficients
```


```{r}
#| warning: false
#| echo: false
set.seed(221)

p1 <- BETA_HAT |>
  ggplot(aes(x = beta0, y = beta1)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon") +
  xlim(c(0, 2)) +
  ylim(c(0, 0.025)) +
  theme_bw() +
  labs(title = "Joint distribution", x = TeX("$\\hat{\\beta}_0$"),
       y = TeX("$\\hat{\\beta}_1$"), fill = "density") +
  annotate(geom = "point", x = popn_model$coefficients[[1]],
           y = popn_model$coefficients[[2]], color = "darkgoldenrod2") + annotate(geom = "text", x = .65, y = 0.009, 
           label = TeX("$\\beta_0, \\beta_1$"), size = 5,
           color = "darkgoldenrod2")

p2 <- BETA_HAT |> 
  ggplot(aes(x = beta0)) +
  geom_density(aes(y = ..density..)) +
  theme_bw() +
  labs(title = "Marginal densities", 
       x = TeX("$\\hat{\\beta}_0$")) +
  geom_vline(xintercept = popn_model$coefficients[[1]],
             color = "darkgoldenrod2")

p3 <- BETA_HAT |> 
  ggplot(aes(x = beta1)) +
  geom_density(aes(y = ..density..)) +
  theme_bw() +
  labs(x = TeX("$\\hat{\\beta}_1$")) +
  geom_vline(xintercept = popn_model$coefficients[[2]], color = "darkgoldenrod2")

(p1) / (p2 + p3) + plot_annotation(title = "Sampling variability in OLS estimates")
```

:::


